@app.route("/api/dialogue", methods=["POST"])

print("HF_API_KEY is None:", HF_API_KEY is None)
print("Sending request to:", HF_API_URL)

def generate_dialogue():
    try:
        data = request.get_json()
        user_input = data.get("text", "")
        if not user_input:
            return {"error": "No input provided."}, 400

        prompt = f"請將這句話補成一段自然對話：{user_input}"

        headers = {
            "Authorization": f"Bearer {HF_API_KEY}",
            "Content-Type": "application/json"
        }

        res = requests.post(HF_API_URL, headers=headers, json={"inputs": prompt}, timeout=30)
        res.raise_for_status()  # <--- 讓它丟出 HTTP 例外
        
        result = res.json()
        output = result[0].get("generated_text", "") if isinstance(result, list) else result.get("generated_text", "")
        return {"dialogue": output.strip()}
    
    except Exception as e:
        print("Hugging Face API failed:", str(e))
        return {"error": f"HuggingFace error: {str(e)}"}, 500
